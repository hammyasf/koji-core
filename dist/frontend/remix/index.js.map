{"version":3,"sources":["../../../src/frontend/remix/index.ts"],"names":["Remix","initialValues","remixInitialValues","isInitialized","console","warn","defaultValues","context","overrides","window","KOJI_OVERRIDES","remixData","log","arrayMerge","dest","source","values","newValue","sendValues","newValues","sendMessage","kojiEventName","data","path","skipUpdate","PlayerState","client","remix"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;;;;;;;IAQaA,K;;;;;;;;;;;;;;;+FACW,E;sGACW,K;;;;;;yBAG5BC,a,EAAuBC,kB,EAA4B;AACtD,UAAI,KAAKC,aAAT,EAAwB;AACtBC,QAAAA,OAAO,CAACC,IAAR,CAAa,kEAAb;AACA;AACD;;AAED,WAAKF,aAAL,GAAqB,IAArB;AAEA,UAAMG,aAAa,GAAG,KAAKC,OAAL,KAAiB,OAAjB,GAA2BL,kBAA3B,GAAgDD,aAAtE;AAEA,UAAIO,SAAS,GAAG,EAAhB;;AACA,UAAIC,MAAM,CAACC,cAAP,IAAyBD,MAAM,CAACC,cAAP,CAAsBF,SAAnD,EAA8D;AAC5DA,QAAAA,SAAS,GAAGC,MAAM,CAACC,cAAP,CAAsBF,SAAtB,CAAgCG,SAAhC,IAA6C,EAAzD;AACD;;AAEDP,MAAAA,OAAO,CAACQ,GAAR,CAAY,eAAZ,EAA6BX,aAA7B;AACAG,MAAAA,OAAO,CAACQ,GAAR,CAAY,cAAZ,EAA4BV,kBAA5B;AACAE,MAAAA,OAAO,CAACQ,GAAR,CAAY,eAAZ,EAA6BN,aAA7B;AACAF,MAAAA,OAAO,CAACQ,GAAR,CAAY,WAAZ,EAAyBJ,SAAzB;AAEAJ,MAAAA,OAAO,CAACQ,GAAR,CAAY,KAAZ,EAAmB,2BAAUN,aAAV,EAAyBE,SAAzB,EAAoC;AACrDK,QAAAA,UAAU,EAAE,oBAACC,IAAD,EAAOC,MAAP;AAAA,iBAAkBA,MAAlB;AAAA;AADyC,OAApC,CAAnB;AAGA,WAAKC,MAAL,GAAc,2BAAUV,aAAV,EAAyBE,SAAzB,EAAoC;AAChDK,QAAAA,UAAU,EAAE,oBAACC,IAAD,EAAOC,MAAP;AAAA,iBAAkBA,MAAlB;AAAA;AADoC,OAApC,CAAd;AAGD;;;0BAGK;AACJ,aAAO,KAAKC,MAAZ;AACD;;;wBAGGC,Q,EAAwB;AAC1B,WAAKD,MAAL,GAAc,2BAAU,KAAKA,MAAf,EAAuBC,QAAvB,EAAiC;AAC7CJ,QAAAA,UAAU,EAAE,oBAACC,IAAD,EAAOC,MAAP;AAAA,iBAAkBA,MAAlB;AAAA;AADiC,OAAjC,CAAd;AAGA,aAAO,KAAKG,UAAL,EAAP;AACD;;;8BAGSC,S,EAAyB;AACjC,WAAKH,MAAL,GAAcG,SAAd;AACA,aAAO,KAAKD,UAAL,EAAP;AACD;;;6BAGQ;AACP,WAAKE,WAAL,CAAiB;AACfC,QAAAA,aAAa,EAAE;AADA,OAAjB;AAGD;;;iCAEoB;AACnB,WAAKD,WAAL,CAAiB;AACfC,QAAAA,aAAa,EAAE,sBADA;AAEfC,QAAAA,IAAI,EAAE;AACJC,UAAAA,IAAI,EAAE,CAAC,WAAD,CADF;AAEJN,UAAAA,QAAQ,EAAE,KAAKD,MAFX;AAGJQ,UAAAA,UAAU,EAAE;AAHR;AAFS,OAAjB;AAQD;;;EApEwBC,wB,kFAIxBC,c,sJA6BAA,c,qJAKAA,c,2JAQAA,c,8JAMAA,c;;AAmBI,IAAMC,KAAK,GAAG,IAAI3B,KAAJ,EAAd","sourcesContent":["import deepmerge from 'deepmerge';\nimport { PlayerState } from '../playerState';\nimport { client } from '../@decorators/client';\n\ndeclare global {\n  interface Window {\n    KOJI_OVERRIDES: any;\n  }\n}\n\nexport class Remix extends PlayerState {\n  private values: any = {};\n  private isInitialized: boolean = false;\n\n  @client\n  init(initialValues: Object, remixInitialValues: Object) {\n    if (this.isInitialized) {\n      console.warn('You are trying to initialize your remix data more than one time.');\n      return;\n    }\n\n    this.isInitialized = true;\n\n    const defaultValues = this.context === 'remix' ? remixInitialValues : initialValues;\n\n    let overrides = {};\n    if (window.KOJI_OVERRIDES && window.KOJI_OVERRIDES.overrides) {\n      overrides = window.KOJI_OVERRIDES.overrides.remixData || {};\n    }\n\n    console.log('initialValues', initialValues);\n    console.log('remixInitial', remixInitialValues);\n    console.log('defaultValues', defaultValues);\n    console.log('overrides', overrides);\n\n    console.log('out', deepmerge(defaultValues, overrides, {\n      arrayMerge: (dest, source) => source,\n    }));\n    this.values = deepmerge(defaultValues, overrides, {\n      arrayMerge: (dest, source) => source,\n    });\n  }\n\n  @client\n  get() {\n    return this.values;\n  }\n\n  @client\n  set(newValue: Object): void {\n    this.values = deepmerge(this.values, newValue, {\n      arrayMerge: (dest, source) => source,\n    });\n    return this.sendValues();\n  }\n\n  @client\n  overwrite(newValues: Object): void {\n    this.values = newValues;\n    return this.sendValues();\n  }\n\n  @client\n  finish() {\n    this.sendMessage({\n      kojiEventName: 'KojiPreview.Finish',\n    });\n  }\n\n  private sendValues() {\n    this.sendMessage({\n      kojiEventName: 'KojiPreview.SetValue',\n      data: {\n        path: ['remixData'],\n        newValue: this.values,\n        skipUpdate: true,\n      },\n    });\n  }\n}\n\nexport const remix = new Remix();\n"],"file":"index.js"}