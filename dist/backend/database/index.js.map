{"version":3,"sources":["../../../src/backend/database/index.ts"],"names":["DatabaseRoutes","PredicateOperator","Database","config","rootPath","rootHeaders","projectId","projectToken","collection","documentName","axios","post","GET","headers","data","document","GET_COLLECTIONS","collections","queryKey","queryValue","SEARCH","predicateKey","predicateOperation","predicateValue","predicate","key","operation","value","documentNames","GET_ALL","results","predicateValues","GET_ALL_WHERE","documentBody","SET","UPDATE","ARRAY_PUSH","ARRAY_REMOVE","DELETE","Base","server"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport { server } from '../@decorators/server';\nimport { Base, BackendConfigurationInput } from '../base';\n\nexport enum DatabaseRoutes {\n  ARRAY_PUSH = '/v1/store/update/push',\n  ARRAY_REMOVE = '/v1/store/update/remove',\n  DELETE = '/v1/store/delete',\n  GET = '/v1/store/get',\n  GET_ALL = '/v1/store/getAll',\n  GET_ALL_WHERE = '/v1/store/getAllWhere',\n  GET_COLLECTIONS = '/v1/store/getCollections',\n  SEARCH = '/v1/store/search',\n  SET = '/v1/store/set',\n  UPDATE = '/v1/store/update',\n}\n\nexport enum PredicateOperator {\n  LESS_THAN = '<',\n  LESS_THAN_OR_EQUAL_TO = '<=',\n  EQUAL_TO = '==',\n  GREATER_THAN = '>',\n  GREATER_THAN_OR_EQUAL_TO = '>=',\n  NOT_EQUAL_TO = '!=',\n  ARRAY_CONTAINS = 'array-contains',\n  ARRAY_CONTAINS_ANY = 'array-contains-any',\n  IN = 'in',\n  NOT_IN = 'not-in',\n}\n\nexport class Database extends Base {\n  private rootPath: string;\n  private rootHeaders: Object;\n\n  constructor(config: BackendConfigurationInput) {\n    super(config);\n\n    this.rootPath = 'https://database.api.gokoji.com';\n\n    this.rootHeaders = {\n      'X-Koji-Project-Id': this.projectId,\n      'X-Koji-Project-Token': this.projectToken,\n      'Content-Type': 'application/json',\n    };\n  }\n\n  @server\n  public async get<T>(collection: string, documentName?: string | null): Promise<T> {\n    const { data } = await axios.post(\n      `${this.rootPath}${DatabaseRoutes.GET}`,\n      {\n        collection,\n        documentName,\n      },\n      { headers: this.rootHeaders },\n    );\n    return data.document;\n  }\n\n  @server\n  public async getCollections(): Promise<string[]> {\n    const {\n      data: { collections = [] },\n    } = await axios.post(`${this.rootPath}${DatabaseRoutes.GET_COLLECTIONS}`, {}, { headers: this.rootHeaders });\n\n    return collections;\n  }\n\n  @server\n  public async search<T>(collection: string, queryKey: string, queryValue: string): Promise<T[]> {\n    const { data } = await axios.post(\n      `${this.rootPath}${DatabaseRoutes.SEARCH}`,\n      {\n        collection,\n        queryKey,\n        queryValue,\n      },\n      { headers: this.rootHeaders },\n    );\n\n    return data;\n  }\n\n  @server\n  public async getWhere<T>(\n    collection: string,\n    predicateKey: string,\n    predicateOperation: PredicateOperator,\n    predicateValue: string,\n  ): Promise<T> {\n    const { data } = await axios.post(\n      `${this.rootPath}${DatabaseRoutes.GET}`,\n      {\n        collection,\n        predicate: {\n          key: predicateKey,\n          operation: predicateOperation,\n          value: predicateValue,\n        },\n      },\n      { headers: this.rootHeaders },\n    );\n\n    return data.document;\n  }\n\n  @server\n  public async getAll<T>(collection: string, documentNames: string[]): Promise<T[]> {\n    const { data } = await axios.post(\n      `${this.rootPath}${DatabaseRoutes.GET_ALL}`,\n      {\n        collection,\n        documentNames,\n      },\n      { headers: this.rootHeaders },\n    );\n\n    return data.results;\n  }\n\n  @server\n  public async getAllWhere<T>(\n    collection: string,\n    predicateKey: string,\n    predicateOperation: PredicateOperator,\n    predicateValues: string[],\n  ): Promise<T[]> {\n    const { data } = await axios.post(\n      `${this.rootPath}${DatabaseRoutes.GET_ALL_WHERE}`,\n      {\n        collection,\n        predicateKey,\n        predicateOperation,\n        predicateValues,\n      },\n      { headers: this.rootHeaders },\n    );\n\n    return data.results;\n  }\n\n  @server\n  public async set(collection: string, documentName: string, documentBody: any): Promise<boolean> {\n    const { data } = await axios.post(\n      `${this.rootPath}${DatabaseRoutes.SET}`,\n      {\n        collection,\n        documentBody,\n        documentName,\n      },\n      { headers: this.rootHeaders },\n    );\n\n    return data;\n  }\n\n  @server\n  public async update(collection: string, documentName: string, documentBody: any): Promise<boolean | void> {\n    const { data } = await axios.post(\n      `${this.rootPath}${DatabaseRoutes.UPDATE}`,\n      {\n        collection,\n        documentBody,\n        documentName,\n      },\n      { headers: this.rootHeaders },\n    );\n\n    return data;\n  }\n\n  @server\n  public async arrayPush(collection: string, documentName: string, documentBody: any): Promise<boolean | void> {\n    const { data } = await axios.post(\n      `${this.rootPath}${DatabaseRoutes.ARRAY_PUSH}`,\n      {\n        collection,\n        documentBody,\n        documentName,\n      },\n      { headers: this.rootHeaders },\n    );\n\n    return data;\n  }\n\n  @server\n  public async arrayRemove(collection: string, documentName: string, documentBody: any): Promise<boolean | void> {\n    const { data } = await axios.post(\n      `${this.rootPath}${DatabaseRoutes.ARRAY_REMOVE}`,\n      {\n        collection,\n        documentBody,\n        documentName,\n      },\n      { headers: this.rootHeaders },\n    );\n\n    return data;\n  }\n\n  @server\n  public async delete(collection: string, documentName: string): Promise<boolean | void> {\n    const { data } = await axios.post(\n      `${this.rootPath}${DatabaseRoutes.DELETE}`,\n      {\n        collection,\n        documentName,\n      },\n      { headers: this.rootHeaders },\n    );\n\n    return data;\n  }\n}\n\nexport interface IDatabase extends Database {}\n"],"file":"index.js"}