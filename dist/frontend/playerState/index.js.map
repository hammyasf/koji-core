{"version":3,"sources":["../../../src/frontend/playerState/index.ts"],"names":["PlayerState","window","params","qs","parse","location","search","ignoreQueryPrefix","href","includes","context","receiptType","callback","execCallbackOnMessage","isRemixing","editorAttributes","KojiBridge","client","playerState"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;;;;;;;IAuBaA,W;;;;;AAIX,yBAAc;AAAA;;AAAA;AACZ,8BADY,CAGZ;AACA;;AAJY,gGAHgB,SAGhB;AAAA;AAKZ,QAAI,OAAOC,MAAP,KAAyB,WAA7B,EAA0C;;AAE1C,QAAMC,MAA+B,GAAGC,eAAGC,KAAH,CAASH,MAAM,CAACI,QAAP,CAAgBC,MAAzB,EAAiC;AAAEC,MAAAA,iBAAiB,EAAE;AAArB,KAAjC,CAAxC;;AAEA,QAAIN,MAAM,CAACI,QAAP,CAAgBG,IAAhB,CAAqBC,QAArB,CAA8B,iBAA9B,CAAJ,EAAsD;AACpD,YAAKC,OAAL,GAAe,YAAf;AACD,KAFD,MAEO;AAAA,4BAC2DR,MAD3D,CACGQ,OADH;AAAA,UACGA,OADH,gCACa,SADb;AAAA,UAC2CC,WAD3C,GAC2DT,MAD3D,CACwB,iBADxB;AAGL,YAAKQ,OAAL,GAAeA,OAAf;AACA,YAAKC,WAAL,GAAmBA,WAAnB;AACD;;AAhBW;AAiBb;;;;8BAGSC,Q,EAAwC;AAChD,aAAO,KAAKC,qBAAL,CACL,gBAAmG;AAAA,YAAhGC,UAAgG,QAAhGA,UAAgG;AAAA,YAApFC,gBAAoF,QAApFA,gBAAoF;AACjGH,QAAAA,QAAQ,CAACE,UAAD,EAAaC,gBAAb,CAAR;AACD,OAHI,EAIL,wBAJK,CAAP;AAMD;;;EA/B8BC,sB,uFAuB9BC,c;;AAWI,IAAMC,WAAW,GAAG,IAAIlB,WAAJ,EAApB","sourcesContent":["import qs from 'qs';\nimport { KojiBridge } from '../kojiBridge';\nimport { client } from '../@decorators/client';\n\nexport type PlayerStateContext = 'about' | 'admin' | 'remix' | 'sticker' | 'receipt' | 'screenshot' | 'default';\n\nexport type PlayerStateReceiptType = 'buyer' | 'seller';\n\nexport interface ExpectedQueryParameters {\n  context?: PlayerStateContext;\n  'dynamic-receipt'?: PlayerStateReceiptType;\n}\n\nexport type EditorType = 'instant' | 'full';\nexport type EditorMode = 'edit' | 'new';\n\nexport interface EditorAttributes {\n  type?: EditorType;\n  mode?: EditorMode;\n}\n\nexport type ReceiptType = 'seller' | 'buyer';\n\nexport type IsRemixingCallback = (isRemixing: boolean, editorAttributes: EditorAttributes) => void;\n\nexport class PlayerState extends KojiBridge {\n  context: PlayerStateContext = 'default';\n  receiptType?: ReceiptType;\n\n  constructor() {\n    super();\n\n    // ToDo: Make this better, as it's just a way to get around the isomorphism\n    // of this package\n    if (typeof window as any === 'undefined') return;\n\n    const params: ExpectedQueryParameters = qs.parse(window.location.search, { ignoreQueryPrefix: true });\n\n    if (window.location.href.includes('koji-screenshot')) {\n      this.context = 'screenshot';\n    } else {\n      const { context = 'default', 'dynamic-receipt': receiptType } = params;\n\n      this.context = context;\n      this.receiptType = receiptType;\n    }\n  }\n\n  @client\n  subscribe(callback: IsRemixingCallback): Function {\n    return this.execCallbackOnMessage(\n      ({ isRemixing, editorAttributes }: { isRemixing: boolean; editorAttributes: EditorAttributes }) => {\n        callback(isRemixing, editorAttributes);\n      },\n      'KojiPreview.IsRemixing',\n    );\n  }\n}\n\nexport const playerState = new PlayerState();\n"],"file":"index.js"}