{"version":3,"sources":["../../../src/backend/secret/index.ts"],"names":["SecretRoutes","Secret","config","rootPath","rootHeaders","projectId","projectToken","keyPath","axios","post","KEYSTORE_GET","scope","token","headers","data","console","log","decryptedValue","resource","expireSeconds","CREATE_SIGNED_REQUEST","url","Base","server"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;;;;;;;IAEKA,Y;;WAAAA,Y;AAAAA,EAAAA,Y;AAAAA,EAAAA,Y;GAAAA,Y,KAAAA,Y;;IAKQC,M;;;;;AAIX,kBAAYC,MAAZ,EAA+C;AAAA;;AAAA;AAC7C,8BAAMA,MAAN;AAD6C;AAAA;AAG7C,UAAKC,QAAL,GAAgB,6BAAhB;AAEA,UAAKC,WAAL,GAAmB;AACjB,2BAAqB,MAAKC,SADT;AAEjB,8BAAwB,MAAKC,YAFZ;AAGjB,sBAAgB;AAHC,KAAnB;AAL6C;AAU9C;;;;;yHAG4BC,O;;;;;;;;uBACJC,kBAAMC,IAAN,WAClB,KAAKN,QADa,SACFH,YAAY,CAACU,YADX,GAErB;AACEC,kBAAAA,KAAK,EAAE,KAAKN,SADd;AAEEO,kBAAAA,KAAK,EAAE,KAAKN,YAFd;AAGEC,kBAAAA,OAAO,EAAPA;AAHF,iBAFqB,EAOrB;AACEM,kBAAAA,OAAO,EAAE,KAAKT;AADhB,iBAPqB,C;;;;AAAfU,gBAAAA,I,qBAAAA,I;AAYRC,gBAAAA,OAAO,CAACC,GAAR,CAAY,GAAZ,EAAiBF,IAAjB;iDAEOA,IAAI,CAACG,c;;;;;;;;;;;;;;;;;;;+HAIiBC,Q,EAAkBC,a;;;;;;;;uBACxBX,kBAAMC,IAAN,WAClB,KAAKN,QADa,SACFH,YAAY,CAACoB,qBADX,GAErB;AACEF,kBAAAA,QAAQ,EAARA,QADF;AAEEC,kBAAAA,aAAa,EAAbA;AAFF,iBAFqB,EAMrB;AAAEN,kBAAAA,OAAO,EAAE,KAAKT;AAAhB,iBANqB,C;;;;AAAfU,gBAAAA,I,sBAAAA,I;kDASDA,IAAI,CAACO,G;;;;;;;;;;;;;;;;;;EA9CYC,U,0FAgBzBC,c,4KAmBAA,c","sourcesContent":["import axios from 'axios';\nimport { server } from '../@decorators/server';\nimport { Base, BackendConfigurationInput } from '../base';\n\nenum SecretRoutes {\n  KEYSTORE_GET = '/v1/keystore/get',\n  CREATE_SIGNED_REQUEST = '/v1/cdn/signedRequest/create',\n}\n\nexport class Secret extends Base {\n  private rootPath: string;\n  private rootHeaders: Object;\n\n  constructor(config: BackendConfigurationInput) {\n    super(config);\n\n    this.rootPath = 'https://rest.api.gokoji.com';\n\n    this.rootHeaders = {\n      'X-Koji-Project-Id': this.projectId,\n      'X-Koji-Project-Token': this.projectToken,\n      'Content-Type': 'application/json',\n    };\n  }\n\n  @server\n  public async resolveValue<T>(keyPath: string): Promise<T> {\n    const { data } = await axios.post(\n      `${this.rootPath}${SecretRoutes.KEYSTORE_GET}`,\n      {\n        scope: this.projectId,\n        token: this.projectToken,\n        keyPath,\n      },\n      {\n        headers: this.rootHeaders,\n      },\n    );\n\n    console.log('d', data);\n\n    return data.decryptedValue;\n  }\n\n  @server\n  public async generateSignedUrl(resource: string, expireSeconds?: number): Promise<string> {\n    const { data } = await axios.post(\n      `${this.rootPath}${SecretRoutes.CREATE_SIGNED_REQUEST}`,\n      {\n        resource,\n        expireSeconds,\n      },\n      { headers: this.rootHeaders },\n    );\n\n    return data.url;\n  }\n}\n"],"file":"index.js"}