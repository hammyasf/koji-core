{"version":3,"sources":["../../../src/frontend/bridge/index.ts"],"names":["KojiBridge","callback","eventName","messageListener","data","event","window","addEventListener","removeEventListener","postMessage","platformMessageName","Promise","resolve","reject","err","parent","_kojiEventName","kojiEventName","_type"],"mappings":";;;;;;;;;;;;;;;;;;;IAUaA,U;;;;;;;2BACMC,Q,EAAoBC,S,EAAmB;AACtD,UAAMC,eAAe,GAAG,SAAlBA,eAAkB,OAA6C;AAAA,YAA1CC,IAA0C,QAA1CA,IAA0C;AAAA,YAC3DC,KAD2D,GACjDD,IADiD,CAC3DC,KAD2D;;AAEnE,YAAIA,KAAK,KAAKH,SAAd,EAAyB;AACvBD,UAAAA,QAAQ,CAACG,IAAD,CAAR;AACD;AACF,OALD;;AAOAE,MAAAA,MAAM,CAACC,gBAAP,CAAwB,SAAxB,EAAmCJ,eAAnC;AAEA,aAAO,YAAM;AACXG,QAAAA,MAAM,CAACE,mBAAP,CAA2B,SAA3B,EAAsCL,eAAtC;AACD,OAFD;AAGD;;;mCAEwBM,W,EAA0BC,mB,EAA2C;AAC5F,aAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,YAAMV,eAAe,GAAG,SAAlBA,eAAkB,QAA6C;AAAA,cAA1CC,IAA0C,SAA1CA,IAA0C;AAAA,cAC3DC,KAD2D,GACjDD,IADiD,CAC3DC,KAD2D;;AAEnE,cAAIA,KAAK,KAAKK,mBAAd,EAAmC;AACjC,gBAAI;AACFE,cAAAA,OAAO,CAACR,IAAD,CAAP;AACD,aAFD,CAEE,OAAOU,GAAP,EAAY;AACZD,cAAAA,MAAM,CAACC,GAAD,CAAN;AACD;;AACDR,YAAAA,MAAM,CAACE,mBAAP,CAA2B,SAA3B,EAAsCL,eAAtC;AACD;AACF,SAVD;;AAYAG,QAAAA,MAAM,CAACC,gBAAP,CAAwB,SAAxB,EAAmCJ,eAAnC;AAEAG,QAAAA,MAAM,CAACS,MAAP,CAAcN,WAAd;AAEIO,UAAAA,cAAc,EAAEP,WAAW,CAACQ,aAFhC;AAGIC,UAAAA,KAAK,EAAET,WAAW,CAACQ;AAHvB,WAIOR,WAAW,CAACL,IAJnB,GAME,GANF;AAQD,OAvBM,CAAP;AAwBD","sourcesContent":["interface MessageListenerData {\n  event: string;\n  token?: string;\n}\n\ninterface PostMessage {\n  kojiEventName: string;\n  data?: any;\n}\n\nexport class KojiBridge {\n  protected listen(callback: Function, eventName: string) {\n    const messageListener = ({ data }: { data: MessageListenerData }) => {\n      const { event } = data;\n      if (event === eventName) {\n        callback(data);\n      }\n    };\n\n    window.addEventListener('message', messageListener);\n\n    return () => {\n      window.removeEventListener('message', messageListener);\n    };\n  }\n\n  protected postToPlatform(postMessage: PostMessage, platformMessageName: string): Promise<any> {\n    return new Promise((resolve, reject) => {\n      const messageListener = ({ data }: { data: MessageListenerData }) => {\n        const { event } = data;\n        if (event === platformMessageName) {\n          try {\n            resolve(data);\n          } catch (err) {\n            reject(err);\n          }\n          window.removeEventListener('message', messageListener);\n        }\n      };\n\n      window.addEventListener('message', messageListener);\n\n      window.parent.postMessage(\n        {\n          _kojiEventName: postMessage.kojiEventName,\n          _type: postMessage.kojiEventName,\n          ...postMessage.data,\n        },\n        '*',\n      );\n    });\n  }\n}\n"],"file":"index.js"}